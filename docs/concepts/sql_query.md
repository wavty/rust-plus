# SQL 查询工具

## 一、目标

设计一个支持对 csv 文件进行 SQL 查询的 rust 库，并且支持使用 Python3 和 Node.js 调用。

## 二、设计分析

### 1.一条 SQL 语句的执行流程

首先输入一条语句，然后进行词法分析，将语句分解成一个个 token，然后进行语法分析，将 token 组合成一个语法树，最后进行语义分析，将语法树转换成一个执行计划，然后执行计划进行执行，最后输出结果。更详细的执行流程见：[一文读懂 MySQL 底层架构实现](https://blog.csdn.net/qq_41345173/article/details/109692384)。

### 2.功能拆分

- SQL 语句解析 ([sqlparser-rs](https://github.com/sqlparser-rs/sqlparser-rs))

- 数据格式化，即把不同的数据源转换为抽象的 DataFrame ([polars-rs](https://docs.rs/polars/latest/polars/#))

## 三、基础知识

### 1. 生命周期标注的作用是什么？

在 Rust 中，生命周期标注（lifetimes）用于解决引用（references）的有效性和所有权的问题。它们帮助编译器确定引用的有效范围，并防止悬垂引用（dangling references）和不安全的操作。

具体来说，生命周期标注用于描述引用的有效时间，即引用可以保持有效的时间范围。这对于涉及引用的函数参数、结构体字段和返回值特别重要。通过使用生命周期标注，你可以告诉编译器引用的有效期是如何与其他对象相关联的。

以下是生命周期标注的一些常见用途：

1. 函数参数：当函数接受引用作为参数时，生命周期标注可以用于指定引用参数的有效期。这样可以避免引用在其所引用的对象已经被释放后仍然存在的问题。

2. 结构体字段：如果结构体包含引用类型的字段，需要使用生命周期标注来确保字段引用的对象在结构体的有效范围内。

3. 函数返回值：当函数返回引用类型时，生命周期标注可以用于指定返回值引用的有效期。这样可以确保返回的引用不会超出原始数据的生命周期。

生命周期标注使用撇号 `'` 后跟标识符来表示，如 `'a`、`'b` 等。它们通常与泛型和函数签名一起使用，以指定引用的有效时间。

通过使用生命周期标注，Rust 编译器可以在编译时进行静态检查，以确保引用的有效性和所有权的正确性。这样可以避免许多常见的内存安全问题，并提供更强的代码可靠性和性能。

需要注意的是，生命周期标注并不引入额外的运行时开销，它们只是在编译时进行静态检查。

### 2. 举一个生命周期标注作用于结构体的例子

当结构体中包含引用类型的字段时，我们可以使用生命周期标注来确保字段引用的有效期与结构体的有效期相符。这样可以避免在结构体中持有悬垂引用或引用已经被释放的对象。

下面是一个使用生命周期标注的结构体的示例：

```rust
struct Container<'a> {
    data: &'a str,
}

impl<'a> Container<'a> {
    fn new(data: &'a str) -> Self {
        Container { data }
    }

    fn get_data(&self) -> &'a str {
        self.data
    }
}

fn main() {
    let data = "Hello, world!";
    let container = Container::new(data);
    let result = container.get_data();
    println!("{}", result);
}
```

在上述示例中，`Container` 结构体的字段 `data` 是一个引用类型，用生命周期标注 `'a` 来表示它的有效期与结构体的有效期一致。通过这样的标注，我们可以确保 `Container` 结构体实例在引用 `data` 字段时，保持引用对象是有效的。

在 `main` 函数中，我们创建了一个 `Container` 结构体实例，并使用 `get_data` 方法获取存储的数据。由于 `Container` 结构体的生命周期与字段引用的生命周期相匹配，我们可以安全地返回字段引用，并在 `main` 函数中打印结果。

通过生命周期标注，编译器可以在编译时检查引用的有效性，并保证不会出现引用非法或悬垂引用的情况，提高了代码的安全性和可靠性。

### 3. 举一个生命周期标注作用于函数的例子

当函数接受引用作为参数时，我们可以使用生命周期标注来指定引用参数的有效期。这样可以避免引用在其所引用的对象已经被释放后仍然存在的问题。

下面是一个使用生命周期标注的函数的示例：

```rust
fn print_data<'a>(data: &'a str) {
    println!("{}", data);
}

fn main() {
    let data = "Hello, world!";
    print_data(data);
}
```

在上述示例中，`print_data` 函数接受一个 `&str` 类型的引用作为参数，并使用生命周期标注 `'a` 来表示引用的有效期。通过这样的标注，我们可以确保引用的有效期与函数的有效期一致。

在 `main` 函数中，我们创建了一个 `&str` 类型的引用，并将其传递给 `print_data` 函数。由于 `print_data` 函数的生命周期与引用的生命周期相匹配，我们可以安全地在函数中使用引用，并在 `main` 函数中打印结果。

### 4. 